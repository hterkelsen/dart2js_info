<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>dart2js_info - Dart API docs</title>
    <!-- required because all the links are pseudo-absolute -->
    <base href=".">

    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Roboto:500,400italic,300,400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="static-assets/prettify.css">
    <link rel="stylesheet" href="static-assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="static-assets/styles.css">

    <meta name="description" content="dart2js_info API docs, for the Dart programming language.">
    <link rel="icon" href="static-assets/favicon.png">

    <!-- Do not remove placeholder -->
    <!-- Header Placeholder -->
</head>

<body>

<div id="overlay-under-drawer"></div>

<header class="container-fluid" id="title">
    <nav class="navbar navbar-fixed-top">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 contents">
              <ol class="breadcrumbs gt-separated hidden-xs">
                  <li class="self-crumb">dart2js_info</li>
              </ol>
              <div class="self-name">dart2js_info</div>
              <form class="search navbar-right" role="search">
                <input type="text" id="search-box" disabled class="form-control typeahead" placeholder="Search">
              </form>
            </div> <!-- /col -->
          </div> <!-- /row -->
        </div> <!-- /container -->
    </nav>

    <div class="container masthead">
      <div class="row">
        <div class="col-sm-12 contents">
          <ol class="breadcrumbs gt-separated visible-xs">
          </ol>
          <div class="title-description">
              <h1 class="title">
                  <div class="kind">package</div> dart2js_info
              </h1>
          </div>
          <ul class="subnav">
              <li><a href="index.html#libraries">Libraries</a></li>
          </ul>
        </div> <!-- /col -->
      </div> <!-- /row -->
    </div> <!-- /container -->

</header>

<div class="container body">
  <div class="row">

  <div class="col-xs-6 col-sm-3 col-md-2 sidebar sidebar-offcanvas-left">
    <h5>dart2js_info</h5>

    <ol>
      <li class="section-title"><a href="index.html#libraries">Libraries</a></li>
      <li><a href="dart2js_info.info/dart2js_info.info-library.html">dart2js_info.info</a></li>
    </ol>
  </div>

  <div class="col-xs-12 col-sm-9 col-md-8 main-content">

      <section class="desc markdown">
      
            <h1>Dart2js Info</h1>
<p>This package contains libraries and tools you can use to process <code>.info.json</code>
files, which are produced when running dart2js with <code>--dump-info</code>.</p>
<p>The <code>.info.json</code> files contain data about each element included in
the output of your program. The data includes information such as:</p><ul><li>the size that each function adds to the <code>.dart.js</code> output,</li><li>dependencies between functions,</li><li>how the code is clustered when using deferred libraries, and</li><li>the declared and inferred type of each function argument.</li></ul>
<p>All of this information can help you understand why some piece of code is
included in your compiled application, and how far was dart2js able to
understand your code. This data can help you make changes to improve the quality
and size of your framework or app.</p>
<p>This package focuses on gathering libraries and tools that summarize all of that
information. Bear in mind that even with all these tools, it is not trivial to
isolate code-size issues. We just hope that these tools make things a bit
earier.</p>
<h2>Status</h2>
<p><a href="https://travis-ci.org/dart-lang/dart2js_info"><a href="https://travis-ci.org/dart-lang/dart2js_info.svg"><img alt="Build Status" src="https://travis-ci.org/dart-lang/dart2js_info.svg"></img></a></a></p>
<p>Currently, most tools available here can be used to analyze code-size and
attibution of code-size to different parts of your app. With time, we hope to
add more data to the <code>.info.json</code> files, and include better tools to help
understand the results of type inference.</p>
<p>This package is still in flux and we might make breaking changes at any time.
Our current goal is not to provide a stable API, we mainly want to expose the
functionality and iterate on it.  We recommend that you pin a specific version
of this package and update when needed.</p>
<h2>Info API</h2>
<p><a href="http://dart-lang.github.io/dart2js_info/doc/api/dart2js_info.info/AllInfo-class.html">AllInfo</a> exposes a Dart representation of the <code>.info.json</code> files.
You can parse the information using <code>AllInfo.parseFromJson</code>. For example:</p>
<pre class="dart"><code>import 'dart:convert';
import 'dart:io';

import 'package:dart2js_info/info.dart';

main(args) {
  var infoPath = args[0];
  var json = JSON.decode(new File(infoPath).readAsStringSync());
  var info = AllInfo.parseFromJson(json);
  ...
</code></pre>
<h2>Available tools</h2>
<p>The following tools are a available today:</p><ul><li>
<p><a href="https://github.com/dart-lang/dart2js_info/blob/master/bin/code_deps.dart"><code>code_deps.dart</code></a>: simple tool that can answer queries about the
dependency between functions and fields in your program. Currently it only
supports the <code>some_path</code> query, which shows a dependency path from one
function to another.</p></li><li>
<p><a href="https://github.com/dart-lang/dart2js_info/blob/master/bin/library_size_split.dart"><code>library_size_split</code></a>: a tool that shows how much code was
attributed to each library. This tool is configurable so it can group data
in many ways (e.g. to tally together all libraries that belong to a package,
or all libraries that match certain name pattern).</p></li><li>
<p><a href="https://github.com/dart-lang/dart2js_info/blob/master/bin/function_size_analysis.dart"><code>function_size_analysis</code></a>: a tool that shows how much
code was attributed to each function. This tool also uses depedency
information to compute dominance and reachability data. This information can
sometimes help determine how much savings could come if the function was not
included in the program.</p></li><li>
<p><a href="https://github.com/dart-lang/dart2js_info/blob/master/bin/coverage_log_server.dart"><code>coverage_log_server</code></a> and <a href="https://github.com/dart-lang/dart2js_info/blob/master/bin/live_code_size_analysis.dart"><code>live_code_size_analysis</code></a>:
dart2js has an experimental feature to gather coverage data of your
application. The <code>coverage_log_server</code> can record this data, and
<code>live_code_size_analysis</code> can correlate that with the <code>.info.json</code>, so you
determine why code that is not used is being included in your app.</p></li></ul>
<p>Next we describe in detail how to use each of these tools.</p>
<h3>Code deps tool</h3>
<p>This command-line tool can be used to query for code dependencies. Currently
this tool only supports the <code>some_path</code> query, which gives you the shortest path
for how one function depends on another.</p>
<p>Run this tool as follows:</p>
<pre class="bash"><code># activate is only needed once to install the dart2js_info* executables
pub global activate dart2js_info
dart2js_info_code_deps out.js.info.json some_path main foo
</code></pre>
<p>The arguments to the query are regular expressions that can be used to
select a single element in your program. If your regular expression is too
general and has more than one match, this tool will pick
the first match and ignore the rest. Regular expressions are matched against
a fully qualified element name, which includes the library and class name
(if any) that contains it. A typical qualified name is of this form:</p>
<pre><code>libraryName::ClassName.elementName
</code></pre>
<p>If the name of a function your are looking for is unique enough, it might be
sufficient to just write that name as your regular expression.</p>
<h3>Library size split tool</h3>
<p>This command-line tool shows the size distribution of generated code among
libraries. It can be run as follows:</p>
<pre class="bash"><code>pub global activate dart2js_info # only needed once
dart2js_info_library_size_split out.js.info.json
</code></pre>
<p>Libraries can be grouped using regular expressions. You can
specify what regular expressions to use by providing a <code>grouping.yaml</code> file:</p>
<pre class="bash"><code>dart2js_info_library_size_split out.js.info.json grouping.yaml
</code></pre>
<p>The format of the <code>grouping.yaml</code> file is as follows:</p>
<pre class="yaml"><code>groups:
- { regexp: "package:(foo)/*.dart", name: "group name 1", cluster: 2}
- { regexp: "dart:.*",              name: "group name 2", cluster: 3}
</code></pre>
<p>The file should include a single key <code>groups</code> containing a list of group
specifications.  Each group is specified by a map of 3 entries:</p><ul><li>
<p><code>regexp</code> (required): a regexp used to match entries that belong to the
  group.</p></li><li>
<p><code>name</code> (optional): the name given to this group in the output table. If
  omitted, the name is derived from the regexp as the match's group(1) or
  group(0) if no group was defined. When names are omitted the group
  specification implicitly defines several groups, one per observed name.</p></li><li>
<p><code>cluster</code> (optional): a clustering index for how data is shown in a table.
  Groups with higher cluster indices are shown later in the table after a
  dividing line. If missing, the cluster index defaults to 0.</p></li></ul>
<p>Here is an example configuration, with comments about what each entry does:</p>
<pre class="yaml"><code>groups:
# This group shows the total size for all libraries that were loaded from
# file:// urls, it is shown in cluster #2, which happens to be the last
# cluster in this example before the totals are shown:
- name: "Loose files"
  regexp: "file://.*"
  cluster: 2

# This group shows the total size of all code loaded from packages:
- { name: "All packages", regexp: "package:.*", cluster: 2}

# This group shows the total size of all code loaded from core libraries:
- { name: "Core libs", regexp: "dart:.*", cluster: 2}

# This group shows the total size of all libraries in a single package. Here
# we omitted the `name` entry, instead we extract it from the regexp
# directly.  In this case, the name will be the package-name portion of the
# package-url (determined by group(1) of the regexp).
- { regexp: "package:([^/]*)", cluster: 1}

# The next two groups match the entire library url as the name of the group.
- regexp: "package:.*"
- regexp: "dart:.*"

# If your code lives under /my/project/dir, this will match any file loaded
from a file:// url, and we use as a name the relative path to it.
- regexp: "file:///my/project/dir/(.*)"
</code></pre>
<p>Regardless of the grouping configuration, the tool will display the total code
size attributed of all libraries, constants, and the program size.</p>
<p><strong>Note</strong>: eventually you should expect all numbers to add up to the program
size. Currently dart2js's <code>--dump-info</code> is not complete, so numbers for
bootstraping code and lazy static initializers are missing.</p>
<h3>Function size analysis tool</h3>
<p>This command-line tool presents how much each function contributes to the total
code of your application.  We use dependency information to compute dominance
and reachability data as well.</p>
<p>When you run:</p>
<pre class="bash"><code>pub global activate dart2js_info # only needed once
dart2js_info_function_size_analysis out.js.info.json
</code></pre>
<p>the tool produces a table output with lots of entries. Here is an example entry
with the corresponding table header:</p>
<pre><code> --- Results per element (field or function) ---
    element size     dominated size     reachable size Element identifier
    ...
     275   0.01%     283426  13.97%    1506543  74.28% some.library.name::ClassName.myMethodName
</code></pre>
<p>Such entry means that the function <code>myMethodName</code> uses 275 bytes, which is 0.01%
of the application. That function however calls other functions, which
transitively can include up to 74.28% of the application size. Of all those
reachable functions, some of them are reachable from other parts of the program,
but a subset are dominated by <code>myMethodName</code>, that is, other parts of the
program starting from <code>main</code> would first go through <code>myMethodName</code> before
reaching those functions. In this example, that subset is 13.97% of the
application size. This means that if you somehow can remove your dependency on
<code>myMethodName</code>, you will save at least that 13.97%, and possibly some more from
the reachable size, but how much of that we are not certain.</p>
<h3>Coverage tools</h3>
<p>Coverage information requires a bit more setup and work to get them running. The
steps are as follows:</p><ul><li>
<p>Compile an app with dart2js using <code>--dump-info</code> and defining the
Dart environment <code>traceCalls=post</code>:</p></li></ul>
<pre><code>DART_VM_OPTIONS="-DtraceCalls=post" dart2js --dump-info main.dart
</code></pre>
<p>  Because coverage/tracing data is currently experimental, the feature is
  not exposed as a flag in dart2js, but you can enable it using the Dart
  environment flag. The flag only works dart2js version 1.13.0-dev.0.0 or newer.</p><ul><li>Launch the coverage server tool to serve up the JS code of your app:</li></ul>
<pre class="bash"><code>dart2js_info_coverage_log_server main.dart.js
</code></pre><ul><li>
<p>(optional) If you have a complex application setup, you may need to serve an
html file or integrate your application server to proxy to the log server
any GET request for the .dart.js file and /coverage POST requests that send
coverage data.</p></li><li>
<p>Load your app and use it to exercise the entire code.</p></li><li>
<p>Shut down the coverage server (Ctrl-C). This will emit a file named
<code>mail.dart.js.coverage.json</code></p></li><li>
<p>Finally, run the live code analysis tool given it both the info and
converage json files:</p></li></ul>
<pre class="bash"><code>dart2js_info_live_code_size_analysis main.dart.info.json main.dart.coverage.json
</code></pre>
<h2>Code location, features and bugs</h2>
<p>This package is developed in <a href="https://github.com/dart-lang/dart2js_info/">github</a>.  Please file feature requests and
bugs at the <a href="https://github.com/dart-lang/dart2js_info/issues">issue tracker</a>.</p>
      
      </section>

    <section class="summary" id="libraries">
      <h2>Libraries</h2>
      <dl>
          <dt id="dart2js_info.info">
            <span class="name "><a href="dart2js_info.info/dart2js_info.info-library.html">dart2js_info.info</a></span>
          </dt>
          <dd>
            
            <p>Data produced by dart2js when run with the <code>--dump-info</code> flag.</p>
          </dd>
      </dl>
    </section>

  </div> <!-- /.main-content -->

  <div class="col-xs-6 col-sm-6 col-md-2 sidebar sidebar-offcanvas-right">

  </div><!--/.sidebar-offcanvas-right-->

  </div> <!-- row -->
</div> <!-- container -->

<footer>
    <div class="container-fluid">
        <div class="container">
            <p class="text-center">
                <span class="no-break">
                  dart2js_info 0.0.3 api docs
                </span>
                &bull;
                <span class="copyright no-break">
                  <a href="https://www.dartlang.org">
                    <img src="static-assets/favicon.png" alt="Dart" title="Dart"width="16" height="16">
                  </a>
                </span>
                &bull;
                <span class="copyright no-break">
                  <a href="http://creativecommons.org/licenses/by-sa/4.0/">cc license</a>
                </span>
            </p>
        </div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="static-assets/typeahead.bundle.min.js"></script>
<script src="static-assets/prettify.js"></script>
<script src="static-assets/script.js"></script>
<!-- Do not remove placeholder -->
<!-- Footer Placeholder -->

<!-- Made with <3 by dartdoc version 0.5.0+2 -->
</body>

</html>
